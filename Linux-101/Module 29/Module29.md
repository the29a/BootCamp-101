# Примеры восстановления при возникновении проблем загрузки 
- Восстановление файловых систем используя fsck
- Тест диска в Linux на наличие ошибок и битых секторов
- Как сбросить пароль root в Linux через GRUB
- Как сбросить пароль root в Linux через Live CD

Fsck (File System ChecK) — проверяет и восстанавливает файловые системы.

Перед запуском проверки отмонтируем файловую систему командой:
	
umount /dev/sda1

Пример запуска проверки (где /dev/sda1 — проверяемое устройство или раздел)
```
fsck -V -C -f /dev/sda1
```
-V - подробное отображение информации
-C - отображать прогресс проверки
-f - принудительная проверка


# Тест диска в Linux на наличие ошибок и битых секторов

Посмотрим список дисков:
```fdisk -l```
```df -h```

Посмотреть информацию и модель диска можно так:
```hdparm -i /dev/sda```

Если поддерживается SMART, установим утилиты и посмотрим статистику SMART:
```
apt-get install smartmontools
smartctl -a /dev/sda
smartctl -a /dev/sda|grep -i reallocated
```
Запуск SMART тестов и просмотр информации (smartctl -X для остановки длинного теста):
```
smartctl -H /dev/sda
smartctl --test=long /dev/sda
smartctl -l selftest /dev/sda
```
Теперь выполним проверку диска на битые сектора (-s отобразит информацию о сканировании, -v более подробный режим):
```badblocks -sv /dev/sda1```

Можно сохранить результат в файл:
```badblocks -sv /dev/sda1 > ~/badblocks.list```

Возможно потребуется отмонтировать диск чтобы проверить:
```umount /dev/sda1```

Выполнить проверку используя e2fsck можно так:
```e2fsck /dev/sda1```

# Как сбросить пароль root в Linux через GRUB


1) При включении системы когда отобразится GRUB с вариантами загрузки, нажмем клавишу e (edit)

2) В открывшемся окне находим строку начинающуюся с linux, найдём в ней ro и изменим на rw, а также допишем в самом конце:

```init=/bin/bash```

Если диск зашифрован, то нужно еще дописать:

```plymouth.enable = 0```

3) Жмем F10 или Ctrl+X для загрузки

4) Теперь изменим пароль root набрав команду passwd и указав два раза новый пароль.
Если вдруг корневая файловая система смонтирована в режиме только для чтения (ro) и не получается изменить пароль, то переведем её в режим записи (rw) командой:
	
```mount -n -o remount,rw /```

Выполним перезагрузку:
```	
/sbin/reboot -f
```
Система запустится как обычно, изменения в GRUB сделанные в пункте 2 не будут сохранены.

# Как сбросить пароль root в Linux через Live CD

После запуска системы посмотрим на какой раздел диска установлен Linux командой (команды нужно выполнять от root пользователя, по этому в Ubuntu для этого в начале используется команда sudo):
```
sudo fdisk -l
```
Создадим директорию и смонтируем в нее раздел:
```
sudo mkdir /media/test
sudo mount /dev/sda3 /media/test
```
Изменим рута в смонтированном разделе
```
sudo chroot /media/test
```
Если возникает ошибка:
```
chroot: failed to run command ‘/bin/bash’: No such file or directory
```
то вы что-то не то смонтировали, возможно swap или какой-то другой раздел.

Изменим пароль:
passwd

Перезапустим систему:
reboot



